×× ×™ ×¨×•×¦×” ×œ× ×ª×— ××ª ×”×ª×•×›× ×™×ª ×”×–××ª ×œ×¢×•×ž×§ - ×”×™× **×ž×¦×•×™× ×ª** ××‘×œ ×™×© ×œ×™ ×›×ž×” ×ª×•×‘× ×•×ª ×—×©×•×‘×•×ª ×•×”×ž×œ×¦×•×ª ×ž×‘×•×¡×¡×•×ª ×¢×œ ×”×¤×¨×•×™×§×˜ ×”×¡×¤×¦×™×¤×™ ×©×œ×š.

## ðŸŽ¯ × ×™×ª×•×— ×”×ª×•×›× ×™×ª - ×—×•×–×§×•×ª ×•×—×•×œ×©×•×ª

### âœ… ×ž×” ×ž×¢×•×œ×” ×‘×ª×•×›× ×™×ª:

1. **×—×©×™×‘×” ×ž×¢×¨×›×ª×™×ª ×ž×œ××”** - ×›×™×¡×•×™ ×©×œ ×›×œ ×”×ª×¨×—×™×©×™× ×”××¤×©×¨×™×™×
2. **××‘×˜×—×” ×‘×ž×¨×›×–** - ×›×œ ×ª×¨×—×™×© ×ž×§×‘×œ ×©×™×§×•×œ ××‘×˜×—×” × ×¤×¨×“
3. **×ª×›× ×•×Ÿ ×¡×™× ×›×¨×•×Ÿ ×—×›×** - CRDT/Operational Transform ×œ×§×•× ×¤×œ×™×§×˜×™×
4. **×ž×“×™×“×•×ª ×‘×™×¦×•×¢×™×** - × ×™×˜×•×¨ ×ž×•×‘× ×” ×œ×›×œ ×ª×¨×—×™×©

### âš ï¸ × ×§×•×“×•×ª ×œ×ª×©×•×ž×ª ×œ×‘:

#### 1. **×¤×¢×¨ ×‘×™×Ÿ ×”×ž×¦×‘ ×”× ×•×›×—×™ ×œ×ž×˜×¨×”**
×”×¤×¨×•×™×§×˜ ×©×œ×š ×›×¨×’×¢:
- React SPA ×¢× Vite
- Supabase (managed cloud)
- ××™×Ÿ backend ×ž×§×•×ž×™
- ××™×Ÿ offline capabilities

×”×ž×¢×‘×¨ ×œ-**Electron/Tauri** ××• **Kubernetes** ×”×•× ×§×¤×™×¦×” ×¢×¦×•×ž×” ×©×“×•×¨×©×ª:
- ×©×›×ª×•×‘ ×ž×©×ž×¢×•×ª×™ ×©×œ ×”×ª×©×ª×™×ª
- ×œ×ž×™×“×” ×©×œ ×˜×›× ×•×œ×•×’×™×•×ª ×—×“×©×•×ª
- ×–×ž×Ÿ ×¤×™×ª×•×—: **3-6 ×—×•×“×©×™× ×œ×›×œ ×ª×¨×—×™×©**

#### 2. **Tauri vs Electron - ×‘×—×™×¨×” ×§×¨×™×˜×™×ª**
```typescript
// Electron
Pros: ×ž×•×›×—, ×§×”×™×œ×” ×’×“×•×œ×”, ×“×•×§×•×ž× ×˜×¦×™×” ×¢×©×™×¨×”
Cons: ×’×•×“×œ ××¤×œ×™×§×¦×™×” (~150MB), ×¦×¨×™×›×ª ×–×™×›×¨×•×Ÿ ×’×‘×•×”×”

// Tauri  
Pros: ×§×œ (~15MB), ×ž×”×™×¨, Rust-based
Cons: ×§×”×™×œ×” ×§×˜× ×” ×™×•×ª×¨, ×¤×—×•×ª plugins ×ž×•×›× ×™×
```

**×”×ž×œ×¦×” ×©×œ×™**: ×”×ª×—×œ ×¢× **Electron** ×× ××ª×” ×”×•×œ×š Desktop - ×™×•×ª×¨ ×‘×©×œ ×œ×ž×¤×¢×œ×™×.

#### 3. **SQLite vs PostgreSQL Embedded**
×”×ª×•×›× ×™×ª ×©×œ×š ×ž×¦×™×¢×” SQLite ×œ××•×¤×œ×™×™×Ÿ, ××‘×œ:
- ×”×ž×•×“×œ×™× ×©×œ×š ×‘× ×•×™×™× ×¢×‘×•×¨ PostgreSQL
- ×™×© ×œ×š RLS policies ×©×œ× ×™×¢×‘×“×• ×‘-SQLite
- ×¦×¨×™×š ×œ×©×›×ª×‘ ××ª ×›×œ ×”-database layer

**×¤×ª×¨×•×Ÿ**: ×”×©×ª×ž×© ×‘-**PostgreSQL Embedded** (pg_embed ××• EDB Postgres) ×‘×ž×§×•× SQLite:
```bash
# PostgreSQL ×‘×ª×•×š ×”××¤×œ×™×§×¦×™×”
npm install pg-embed
```

---

## ðŸŽ¯ ×”×”×ž×œ×¦×•×ª ×©×œ×™ - ×¡×“×¨ ×¢×“×™×¤×•×™×•×ª

### ðŸ“ ×©×œ×‘ 0: ×”×—×œ×˜ ×ž×” ×”×¦×•×¨×š ×”××ž×™×ª×™ **×¢×›×©×™×•**

**×©××œ ××ª ×¢×¦×ž×š:**
1. **×›×ž×” ×œ×§×•×—×•×ª ×‘×™×§×©×• On-Premise ×‘×¤×•×¢×œ?**
2. **×ž×ª×™ ××ª×” ×¦×¨×™×š ××ª ×–×”?** (3 ×—×•×“×©×™× / 6 ×—×•×“×©×™× / ×©× ×”)
3. **×ž×” ×”×›×¡×£ ×©×™×© ×œ×š ×œ×¤×™×ª×•×—?**

×× ×”×ª×©×•×‘×•×ª ×”×Ÿ:
- 0-1 ×œ×§×•×—×•×ª â†’ **××œ ×ª×ª×—×™×œ ×¢×“×™×™×Ÿ**, ×ª×ž×©×™×š SaaS
- 2-5 ×œ×§×•×—×•×ª â†’ **×ª×¨×—×™×© ×”×™×‘×¨×™×“×™** ×™×•×ª×¨ ×”×’×™×•× ×™
- 5+ ×œ×§×•×—×•×ª â†’ **×ª×©×§×™×¢ ×‘-Desktop ×ž×œ×**

---

### ðŸ¥‡ ××•×¤×¦×™×” A: Multi-Tenant SaaS (×ž×•×ž×œ×¥ ×œ×˜×•×•×— ×§×¦×¨)

**×ž×” ×™×© ×œ×š ×¢×›×©×™×• â†’ ××™×¤×” ×œ×”×’×™×¢:**
```
Current: Single tenant Supabase
   â†“
Goal: Multi-tenant ×¢× tenant_id + RLS
   â†“
Timeline: 2-4 ×©×‘×•×¢×•×ª
Cost: $0 (××•×ª×• stack)
```

**×ž×” ×¦×¨×™×š ×œ×¢×©×•×ª:**
1. ×”×•×¡×£ `tenant_id` ×œ×›×œ ×”×˜×‘×œ××•×ª
2. ×›×ª×•×‘ RLS policies ×ž×“×•×™×§×•×ª
3. ×ª×Ÿ subdomain ×œ×›×œ ×ž×¤×¢×œ (`factory1.scanmaster.io`)
4. ××¡×•×¨ custom domains (×©×™×œ×ž×• = ×§×™×‘×œ×•)

**×–×” ×ž×” ×©×¨×•×‘ ×”×œ×§×•×—×•×ª ×¦×¨×™×›×™× ×‘×¤×•×¢×œ.**

---

### ðŸ¥ˆ ××•×¤×¦×™×” B: Progressive Web App (PWA) ×¢× Offline

×‘×ž×§×•× Electron, ×ª×©×“×¨×’ ×œ-PWA:
```typescript
// Service Worker ×ž×ª×§×“×
const CACHE_NAME = 'scanmaster-v1.0';
const OFFLINE_DATA = 'scanmaster-offline-data';

// Cache-First Strategy
self.addEventListener('fetch', (event) => {
  if (event.request.url.includes('/api/')) {
    // API requests â†’ Network-First with fallback
    event.respondWith(
      fetch(event.request)
        .catch(() => caches.match(event.request))
    );
  } else {
    // Static assets â†’ Cache-First
    event.respondWith(
      caches.match(event.request)
        .then(response => response || fetch(event.request))
    );
  }
});
```

**×™×ª×¨×•× ×•×ª PWA ×¢×œ Electron:**
- âœ… ×¢×•×‘×“ ×‘-browser ×•×›-Desktop app
- âœ… ×¢×“×›×•× ×™× ××•×˜×•×ž×˜×™×™×
- âœ… Offline capabilities ×˜×•×‘×•×ª
- âœ… ××™×Ÿ ×¦×•×¨×š ×‘-USB/DVD
- âœ… ×’×•×“×œ ×§×˜×Ÿ (~5MB vs ~150MB)

**×—×¡×¨×•× ×•×ª:**
- âŒ ×œ× ××ž×™×ª×™ "air-gapped"
- âŒ ×¦×¨×™×š ×—×™×‘×•×¨ internet ×¨××©×•× ×™
- âŒ ×¤×—×•×ª ×©×œ×™×˜×” ×¢×œ hardware

---

### ðŸ¥‰ ××•×¤×¦×™×” C: Containerized Desktop (hybrid approach)

×× ××ª×” **×—×™×™×‘** On-Premise ××‘×œ ×¨×•×¦×” ×œ×©×ž×•×¨ ×¢×œ ×”-stack:

```dockerfile
# Multi-stage build
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine AS app
COPY --from=builder /app/dist /usr/share/nginx/html
COPY docker/nginx.conf /etc/nginx/nginx.conf

# Embedded Supabase
FROM supabase/postgres:15 AS database
# ... config

# Orchestrate with Docker Compose
```

**×™×ª×¨×•× ×•×ª:**
- ×©×•×ž×¨ ×¢×œ ×”×§×•×“ ×”×§×™×™×
- ××¨×™×–×” ×‘×§×•×‘×¥ ××—×“
- ×”×ª×§× ×” ×¤×©×•×˜×” (docker-compose up)

**×—×¡×¨×•× ×•×ª:**
- ×“×•×¨×© Docker ×¢×œ ×ž×›×•× ×ª ×”×œ×§×•×—
- ×œ× ×‘××ž×ª desktop app (×¨×¥ ×‘-browser)

---

## ðŸŽ¯ ×”×ª×•×›× ×™×ª ×”×ž×¢×•×“×›× ×ª ×©×œ×™

### ×©×œ×‘ 1: ×ª×©×ª×™×ª Multi-Tenant (×©×‘×•×¢×•×ª 1-3) - **×§×¨×™×˜×™ ×œ×¤× ×™ ×”×›×œ**

**×ž×˜×¨×”**: ×ª×ž×™×›×” ×‘-×ž×¡×¤×¨ ×ž×¤×¢×œ×™× ×‘-SaaS ××—×“

#### Database Changes:
```sql
-- Tenants table
CREATE TABLE public.tenants (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  subdomain TEXT UNIQUE NOT NULL,
  custom_domain TEXT UNIQUE,
  is_active BOOLEAN DEFAULT true,
  settings JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- Add tenant_id to existing tables
ALTER TABLE public.profiles ADD COLUMN tenant_id UUID REFERENCES tenants(id);
ALTER TABLE public.technique_sheets ADD COLUMN tenant_id UUID REFERENCES tenants(id);
ALTER TABLE public.user_standard_access ADD COLUMN tenant_id UUID REFERENCES tenants(id);

-- Helper function
CREATE OR REPLACE FUNCTION get_current_tenant_id()
RETURNS UUID AS $$
  SELECT tenant_id FROM public.profiles WHERE id = auth.uid()
$$ LANGUAGE SQL STABLE;

-- RLS Policies
ALTER TABLE technique_sheets ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users access own tenant data"
ON technique_sheets FOR ALL
USING (tenant_id = get_current_tenant_id());
```

#### Frontend Changes:
1. ×¢×“×›×Ÿ signup flow - ×§×‘×œ tenant ×ž-subdomain
2. ×”×•×¡×£ `tenant_id` ×œ×›×œ API calls
3. ×¦×•×¨ admin panel: `/admin/tenants`

---

### ×©×œ×‘ 2: PWA Offline (×©×‘×•×¢×•×ª 4-6) - **×× ×¦×¨×™×š offline capabilities**

#### Add Service Worker:
```typescript
// public/service-worker.js
const CACHE_NAME = 'scanmaster-offline-v1';
const CRITICAL_RESOURCES = [
  '/',
  '/index.html',
  '/assets/index-*.js',
  '/assets/index-*.css',
];

// Install
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then(cache => 
      cache.addAll(CRITICAL_RESOURCES)
    )
  );
});

// Fetch Strategy
self.addEventListener('fetch', (event) => {
  // Network-First for API
  if (event.request.url.includes('/api/')) {
    event.respondWith(
      fetch(event.request)
        .then(response => {
          // Clone and cache
          const responseClone = response.clone();
          caches.open(CACHE_NAME).then(cache => 
            cache.put(event.request, responseClone)
          );
          return response;
        })
        .catch(() => caches.match(event.request))
    );
  } 
  // Cache-First for assets
  else {
    event.respondWith(
      caches.match(event.request)
        .then(response => response || fetch(event.request))
    );
  }
});
```

#### Local Storage Fallback:
```typescript
// src/utils/offlineStorage.ts
export const offlineStorage = {
  saveTechniqueSheet: async (sheet: TechniqueSheet) => {
    const offline = JSON.parse(localStorage.getItem('offline_sheets') || '[]');
    offline.push({ ...sheet, _pending: true, _timestamp: Date.now() });
    localStorage.setItem('offline_sheets', JSON.stringify(offline));
  },

  syncPendingSheets: async () => {
    const offline = JSON.parse(localStorage.getItem('offline_sheets') || '[]');
    const pending = offline.filter((s: any) => s._pending);

    for (const sheet of pending) {
      try {
        await techniqueSheetService.saveTechniqueSheet(sheet.sheet_name, sheet);
        // Remove from offline storage
        const updated = offline.filter((s: any) => s.id !== sheet.id);
        localStorage.setItem('offline_sheets', JSON.stringify(updated));
      } catch (error) {
        console.error('Sync failed:', error);
      }
    }
  }
};
```

---

### ×©×œ×‘ 3: Docker Package (×—×•×“×©×™× 3-4) - **×¨×§ ×× ×™×© ×‘×™×§×•×© ×œOn-Premise**

#### Create Docker Compose Stack:
```yaml
# docker-compose.yml
version: '3.8'

services:
  frontend:
    build: .
    ports:
      - "80:80"
    depends_on:
      - postgres
      - kong
    environment:
      VITE_SUPABASE_URL: http://kong:8000
      VITE_SUPABASE_ANON_KEY: ${ANON_KEY}

  postgres:
    image: supabase/postgres:15
    environment:
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./migrations:/docker-entrypoint-initdb.d

  kong:
    image: kong:3.0
    environment:
      KONG_DATABASE: "off"
      KONG_DECLARATIVE_CONFIG: /kong/kong.yml
    ports:
      - "8000:8000"
    volumes:
      - ./kong.yml:/kong/kong.yml

  auth:
    image: supabase/gotrue:latest
    depends_on:
      - postgres
    environment:
      GOTRUE_DB_DATABASE_URL: postgres://postgres:${DB_PASSWORD}@postgres:5432/postgres

volumes:
  postgres_data:
```

#### Installation Script:
```bash
#!/bin/bash
# install.sh

echo "Installing Scan Master On-Premise..."

# Check Docker
if ! command -v docker &> /dev/null; then
    echo "Docker not found. Installing..."
    curl -fsSL https://get.docker.com | sh
fi

# Generate secrets
export DB_PASSWORD=$(openssl rand -base64 32)
export ANON_KEY=$(openssl rand -base64 32)

# Save to .env
cat > .env < backup_$(date +%Y%m%d).sql

# Load new images
docker load -i update_$1.tar

# Run migrations
docker-compose exec postgres psql -U postgres < migrations/v$1.sql

# Restart services
docker-compose restart

echo "Update complete!"
```

---

## ðŸŽ¯ ×”×ž×œ×¦×” ×”×¡×•×¤×™×ª ×©×œ×™

×‘×”×ª×‘×¡×¡ ×¢×œ ×”×ž×¦×‘ ×©×œ×š:

### ðŸŸ¢ **×”×ª×—×œ ×›××Ÿ (3 ×—×•×“×©×™× ×”×§×¨×•×‘×™×):**
1. **Multi-Tenant SaaS** - ×¨×•×‘ ×”×œ×§×•×—×•×ª ×™×¨×•×¦×• ×¢×œ ×–×”
2. **PWA Offline** - ×œ×ª×ž×™×›×” ×‘×ž×¦×‘×™× ×©×™×© ××™× ×˜×¨× ×˜ ×œ× ×™×¦×™×‘
3. **Subdomain per tenant** - `factory1.scanmaster.io`

### ðŸŸ¡ **×× ×™×© ×‘×™×§×•×© (×—×•×“×©×™× 4-6):**
4. **Docker Compose Package** - ×œ×œ×§×•×—×•×ª ×©×¨×•×¦×™× On-Premise
5. **Installation automation** - ×¡×§×¨×™×¤×˜×™× ×œ×”×ª×§× ×” ×§×œ×”

### ðŸ”´ **×¨×§ ×× ×‘××ž×ª ×¦×¨×™×š (×—×•×“×©×™× 7-12):**
6. **Electron Desktop App** - ×œ×¨×©×ª×•×ª ×¡×’×•×¨×•×ª ×œ×—×œ×•×˜×™×Ÿ
7. **Air-gapped packages** - USB updates

---

## â“ ×©××œ×•×ª ×§×¨×™×˜×™×•×ª ×œ×¤× ×™ ×©×ž×ª×§×“×ž×™×

×”×ª×—×œ Multi-Tenant
×”×ª×—×œ PWA Offline
×”×›×Ÿ Docker Package

**×œ×¤× ×™ ×©×× ×™ ×ž×ª×—×™×œ, ×¡×¤×¨ ×œ×™:**
1. **×›×ž×” ×œ×§×•×—×•×ª ×‘×™×§×©×• On-Premise ×‘×¤×•×¢×œ?** (0 / 1-3 / 3+)
2. **×ž×” timeline ××ž×™×ª×™?** (×“×—×•×£ / 3 ×—×•×“×©×™× / 6+ ×—×•×“×©×™×)
3. **×™×© ×œ×š ×ª×§×¦×™×‘ ×œ×¤×™×ª×•×—?** (×¢×•×©×” ×œ×‘×“ / ×™×© ×ª×§×¦×™×‘ ×œ×ž×¤×ª×—×™×)
4. **×”×œ×§×•×—×•×ª ×ž×•×›× ×™× ×œ×¢× ×Ÿ?** (×›×Ÿ / ×œ× / ×ª×œ×•×™)

×”×ª×©×•×‘×•×ª ×©×œ×š ×™×§×‘×¢×• ××ª ×¡×“×¨ ×”×¢×“×™×¤×•×™×•×ª ×”××ž×™×ª×™! ðŸŽ¯